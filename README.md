- [1. Overview](#1-overview)
- [2. Maintainer](#2-maintainer)
- [3. Run Isaac Sim](#3-run-isaac-sim)
  - [3.1. Troubleshooting](#31-troubleshooting)
- [4. Build](#4-build)
- [Build all packages](#build-all-packages)
- [Or only your package](#or-only-your-package)


---
<a name="overview"></a>
# 1. Overview

This repository contains the environment to run and test algorithms for the UR5 of the Laboratory of Robotics at Federal University of Bahia (UFBA). It is possible to test sensors integrations such as RGB+D cameras, generate point clouds, etc.

⚠️ The main reason to use this repository is to avoid damaging the robot with untested algorithms such as trajectory planning, grasping generators, etc.


**Keywords:** Robot manipulators, UR5 Simulation, LaR UFBA


```
.
├─── 📂 config                    # Soft robot configuration file
│    └─── 📂 rviz                 # rviz configuration file
├─── 📂 launch                    # Soft robot launch files
├─── 📂 generated_sym_functions   # Symbolic functions (folder generated by script)
├─── 📂 softrobots_dynamic_model  # Multi segment related python algorithms
│    └─── 📂 helper_funcs         # Scripts to plot robot, calculate the system dynamics and load symbolic functions
│    └─── 📂 symbolic_soft        # Scripts to generate symbolic functions
├─── 📂 usd                       # Isaac sim simulation files
└── ...
```

---
<a name="maintainer"></a>
# 2. Maintainer

**Authors:** Caio Viturino
**Affiliation:** UFBA (PhD Candidate) / SENAI SIMATEC (Robotics Specialist)
**Maintainers:** Caio Viturino (engcaiobarros@gmail.com / caio.viturino@fieb.org.br)

The `softrobots_dynamic_model` package has been tested under [ROS] Humble and Ubuntu 22.04. This is research code, expect that it changes often and any fitness for a particular purpose is disclaimed.

| OS | ROS | Isaac Sim | CUDA | Nvidia Driver |
| :---: | :---: | :---: | :---: | :---: |
| Ubuntu 22.04 | ROS2 Humble | 2022.2.1 | 12.0 | 525.105.17

⚠️ Please check the minimum hardware requirement to run ISAAC SIM in this [website](https://docs.omniverse.nvidia.com/app_isaacsim/app_isaacsim/requirements.html#isaac-sim-short-system-requirements). It is highly recommended to have at least an RTX 3060 GPU.

The simplest way to install the nvidia driver is to go to "Additional drivers" and choose `"using NVIDIA driver metapackage from nvidia-driver-525 (proprietary)"`. If you have any trouble installing this driver, uninstall the all the nvidia drivers before installing a new one: 
```bash
sudo apt-get remove --purge '^nvidia-.*'
```

---
# 3. Run Isaac Sim
 - The Isaac Python is in the following folder (Verify your Isaac Version).
    ```
    /home/$USER/.local/share/ov/pkg/isaac_sim-2022.2.1/kit/python/bin/python3
    ```
    Check the following [page](https://docs.omniverse.nvidia.com/app_isaacsim/app_isaacsim/manual_standalone_python.html) for more instructions.

  - To reduce manual work in openning Isaac Sim, add the following alias to the .bashrc file.
    ```bash
    python_isaac() {
      "/home/caio/.local/share/ov/pkg/isaac_sim-2022.2.1/python.sh" "$1"
      }
    ```
  
  - Just run the run_simulation.py (**Do not source ROS2 in this terminal**):
    ```bash
    python_isaac run_simulation.py
    ```
  - (**OPTINAL**) - Add the following alias to the ~/.bashrc file to build and run and build your main code faster:
    ```bash
    alias build_ur5='source /opt/ros/humble/setup.bash && cd ~/YOUR_WORKSPACE && colcon build && source install/setup.bash'
    alias run_ur5='ros2 run ur5_isaac_simulation ur5_isaac_ros2'
    ```

## 3.1. Troubleshooting
  - Isaac Sim takes some time to load when the following warning message appears. In this case, just wait a few seconds (280 or more depending on your GPU).
    ```bash
    [Warning] [gpu.foundation.plugin] Waiting for compilation of ray tracing shaders by GPU driver: 30 seconds so far
    ```
    After the following warning message appears, Isaac sim should not take too long to load:
    ```bash
    [gpu.foundation.plugin] Ray tracing shader compilation finished after 281 seconds
    ```

---
# 4. Build
 - Clone this repository inside your src folder
   ```
   cd YOUR_WORKSPACE/src
   git clone THIS_REPOSITORY_LINK
   ```
   
   Build the all package or only your package
 - ```bash
   cd YOUR_WORKSPACE
   # Build all packages
   colcon build
   # Or only your package
   colcon build --packages-select my_package
   ```
 - Source ROS2 and your ROS2 workspace:
    ```bash
    # source ROS2 Humble
    source /opt/ros/humble/setup.bash
    # your your workspace
    cd YOUR_WORKSPACE
    source install/local_setup.bash
    ```

 - Install the package dependencies:
    ```bash
    cd YOUR_WORKSPACE
    rosdep install --from-paths src -y --ignore-src
    ```
